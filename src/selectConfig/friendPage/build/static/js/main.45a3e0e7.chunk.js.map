{"version":3,"sources":["rootCA.crt","configItem.js","App.js","index.js"],"names":["module","exports","confirm","Modal","Meta","Card","itemAction","delete","select","edit","ConfigItem","restartConfirm","title","content","okText","okType","cancelText","onOk","selectConfigConfirm","onCancel","console","log","selectCurItem","props","selectConfig","data","editCurItem","editConfig","doAction","action","turnOffProxyServer","stopCurConfig","this","spinning","runing","tip","onClick","count","itemIndex","style","backgroundColor","fileData","description","actions","className","type","key","fileName","Component","crt","require","Panel","Collapse","App","state","configs","startUpSuc","runningConfigsName","connectError","pacAddress","params","SELECT_CONFIG","payload","ws","send","JSON","stringify","EDIT_CONFIG","showMsg","status","info","message","processStartUp","startSuc","msg","setState","GET_PAC_ADDRESS","GET_CURRENT_CONFIG","setCurrentConfig","fileNames","map","v","length","setPacAddress","setSelectedItemData","curItemConfig","versionCompare","latestVersion","localVersion","text","showUpdateTip","getCurConfig","FETCH_ALL_CONFIGS","checkUpdate","CHECK_UPDATE","notification","duration","stopConfig","STOP_CONFIG","WebSocket","addEventListener","evt","result","parse","e","warn","START_CALLBACK","setTimeout","window","location","reload","showIcon","index","proxyIsRunning","includes","href","target","download","accordion","header","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.45a3e0e7.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/rootCA.45130045.crt\";","import './item.css';\n\nimport React,{Component} from 'react';\nimport {Card, Icon, Avatar, Spin, Modal, Badge} from 'antd';\nconst { confirm } = Modal;\n\nconst { Meta } = Card;\n\nconst itemAction = {\n  delete: 'delete',\n  select: 'select',\n  edit: 'edit'\n}\nexport default  class ConfigItem extends Component{\n  restartConfirm = () => {\n    confirm({\n      title: '切换配置',\n      content: '代理服务器运行中，需要换到当前配置吗？',\n      okText: '好的',\n      okType: 'danger',\n      cancelText: '取消切换',\n      onOk: () => {\n        this.selectConfigConfirm()\n      },\n      onCancel() {\n        console.log('Cancel');\n      },\n    });\n  }\n  \n  selectCurItem = () => {\n    this.selectConfigConfirm();\n  }\n  selectConfigConfirm = () => {\n    this.props.selectConfig(this.props.data)\n  \n  }\n  editCurItem = () => {\n    this.props.editConfig(this.props.data);\n  }\n  doAction = (action) => {\n    switch (action) {\n      case itemAction.select:\n        this.selectCurItem();\n        break;\n      case itemAction.edit:\n        this.editCurItem();\n        break;\n      default:\n        console.log('没有相应的action', action)\n    }\n  }\n  turnOffProxyServer = () => {\n    this.props.stopCurConfig && this.props.stopCurConfig()\n  }\n  render(){\n    const {data} = this.props;\n    return (\n      <Spin spinning={this.props.runing} tip={<div onClick={this.turnOffProxyServer}>代理中,点击可停止... </div>}>\n        <div>\n          <Card\n            title={<div>\n              <Badge count={this.props.itemIndex + 1} style={{ backgroundColor: '#52c41a' }} />\n              {data.fileData.description}</div>}\n            actions={[\n              <div className=\"icon-container\" onClick={() => {this.doAction(itemAction.select)}}>\n                <Icon type=\"heart\" key=\"heart\"/>\n                <span>选择</span>\n              </div>,\n              <div className=\"icon-container\" onClick={() => {this.doAction(itemAction.edit)}}>\n                <Icon type=\"edit\" key=\"edit\"/>\n                <span>修改</span>\n              </div>,\n              <div className=\"icon-container\">\n                <Icon type=\"delete\" key=\"delete\"/>\n                <span>删除</span>\n              </div>,\n            ]}\n          >\n            <Meta\n              description={<div>\n                {data.fileData.description ? data.fileData.description : `${data.fileName}无描述`}</div>}\n            />\n          </Card>\n        </div>\n      </Spin>\n      \n    )\n  }\n}\n","\nimport React, {Component} from 'react';\nimport './App.css';\nimport { message,Alert,notification ,Divider,Collapse} from 'antd';\nimport ConfigItem from './configItem';\nconst crt = require(\"./rootCA.crt\");\nconst { Panel } = Collapse;\n\n\n\nconst actions = {\n  'FETCH_ALL_CONFIGS': 'getAllConfig',\n  'SELECT_CONFIG': 'select_config',\n  'EDIT_CONFIG': 'edit_config',\n  'START_CALLBACK':'start_callback',\n  'GET_CURRENT_CONFIG': 'get_current_config',\n  'CHECK_UPDATE': 'CHECK_UPDATE',\n  'STOP_CONFIG': 'STOP_CONFIG',\n  'GET_PAC_ADDRESS': 'GET_PAC_ADDRESS'\n}\n\n\nclass App extends Component {\n  state = {\n    configs: [],\n    startUpSuc: false,\n    runningConfigsName: [],\n    connectError: false,\n    pacAddress: ''\n  }\n  selectConfig = (data) => {\n    const params = {\n      action: actions.SELECT_CONFIG,\n      payload: data\n    }\n    this.ws.send(JSON.stringify(params))\n  }\n  editConfig = (data) => {\n    const params = {\n      action: actions.EDIT_CONFIG,\n      payload: data\n    }\n    this.ws.send(JSON.stringify(params))\n  }\n  showMsg = (status, info) => {\n    message[status](info)\n  }\n\n  processStartUp = (payload) => {\n    this.showMsg(payload.startSuc ? 'success' : 'error', payload.msg);\n    this.setState({startUpSuc: payload.startSuc}, () => {\n      // !this.state.startUpSuc && this.restartConfirm()\n      if (this.state.startUpSuc) {\n        this.setState({runningConfigsName: payload.fileName});\n        this.ws.send(JSON.stringify({action: actions.GET_PAC_ADDRESS}));\n      }\n    });\n    //获取所有启动项目\n    this.ws.send(JSON.stringify({action: actions.GET_CURRENT_CONFIG}));\n  }\n  setCurrentConfig = (payload) => {\n    // debugger\n    const fileNames = payload.map(v => v.fileName);\n    this.setState({runningConfigsName: fileNames});\n    if (fileNames.length === 0) {\n      this.ws.send(JSON.stringify({action: actions.GET_PAC_ADDRESS}));\n    }\n  }\n  setPacAddress = (pacAddress) => {\n    this.setState({pacAddress})\n  }\n  setSelectedItemData = (data) => {\n    this.setState({curItemConfig: data})\n  }\n  versionCompare = ({latestVersion,localVersion}) => {\n    if (latestVersion !== localVersion) {\n      const text = `检测到新版本${latestVersion},当前版本为${localVersion},请升级获得更多代理规则支持 + 错误修复`\n      this.showUpdateTip(text)\n    }\n  }\n  getCurConfig = () => {\n    this.ws.send(JSON.stringify({action: actions.FETCH_ALL_CONFIGS}));\n    this.ws.send(JSON.stringify({action: actions.GET_CURRENT_CONFIG}));\n  \n  }\n  componentDidMount() {\n    //发送请求获取配置信息\n    let ws = new WebSocket(\"ws://localhost:9876\");\n    this.ws = ws;\n    \n    ws.addEventListener(\"open\",(evt) => {\n      console.log(\"Connection open ...\");\n      // ws.send(\"Hello WebSockets!\");\n      this.setState({connectError: false});\n      this.getCurConfig();\n      this.checkUpdate();\n    })\n  \n  \n    ws.addEventListener(\"message\",(evt) => {\n      console.log( \"Received Message: \" , evt.data);\n      // ws.close();\n      let result ;\n      try {\n        result = JSON.parse(evt.data);\n      } catch (e) {\n        console.warn('传递数据无法json化，格式错误');\n        return\n      }\n      if (result.action === actions.FETCH_ALL_CONFIGS) {\n        this.setState({configs: result.payload});\n      }\n      if (result.action === actions.START_CALLBACK) {\n        const {payload} = result;\n        this.processStartUp(payload)\n      }\n      if (result.action === actions.GET_CURRENT_CONFIG) {\n        const {payload} = result;\n        payload && this.setCurrentConfig(payload)\n      }\n      if (result.action === actions.GET_PAC_ADDRESS) {\n        const {payload} = result;\n        payload && this.setPacAddress(payload)\n      }\n      if (result.action === actions.EDIT_CONFIG) {\n        const {payload} = result;\n        payload && this.setSelectedItemData(payload)\n      }\n      if (result.action === actions.CHECK_UPDATE) {\n        const {payload} = result;\n        payload && this.versionCompare(payload)\n      }\n      \n    })\n  \n    ws.addEventListener('close', (evt) => {\n      console.log(\"Connection closed.\");\n      this.setState({connectError: true});\n      setTimeout(() => {\n        window.location.reload()\n      }, 10000)\n    });\n  }\n  checkUpdate = (data) => {\n    const params = {\n      action: actions.CHECK_UPDATE,\n      payload: data\n    }\n    this.ws.send(JSON.stringify(params))\n  }\n  showUpdateTip = (text) => {\n    notification['info']({\n      message: 'b-proxy-cli 检测到新版本',\n      duration:null,\n      description:text\n    });\n  \n  }\n  stopConfig = (fileName) => {\n    const params = {\n      action: actions.STOP_CONFIG,\n      payload: fileName\n    }\n    this.ws.send(JSON.stringify(params));\n    // setTimeout(this.getCurConfig,1000)\n  }\n  \n  render(){\n  \n    return (\n      <div className=\"App\">\n        \n        {this.state.connectError && (\n          <Alert\n            message=\"与代理服务器的通信失败\"\n            description=\"代理服务器可能没有启动,10s后网页会刷新重试...\"\n            type=\"error\"\n            showIcon\n          />\n        )}\n          <div className={'config-container'}>\n            {this.state.configs.map((v,index) => {\n              return (\n                <ConfigItem\n                  selectConfig={this.selectConfig}\n                  editConfig={this.editConfig}\n                  stopCurConfig={()=>{this.stopConfig(v.fileName)}}\n                  data = {v}\n                  proxyIsRunning={this.state.runningConfigsName.length !== 0}\n                  runing={this.state.runningConfigsName.includes(v.fileName)}\n                  key={index}\n                  itemIndex={index}\n                />\n              )\n            })}\n          </div>\n        <Divider/>\n  \n        <div className={'footer'}>\n          <a href={crt} target={\"_blank\"} download>点击下载根证书</a>\n          {!this.state.connectError && (\n            <div>\n              自动代理配置url：{this.state.pacAddress}\n            </div>\n          )}\n          <Divider/>\n          <Collapse accordion>\n            <Panel header=\"如何备份我的配置\" key=\"1\">\n              <p>组件升级的时候，会覆盖安装组件，覆盖配置文件，为了保存你的配置文件，请拷贝配置文件到其他地方，当更新后，拷贝回来即可</p>\n            </Panel>\n          </Collapse>\n        </div>\n      </div>\n    );\n  }\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport 'antd/dist/antd.css'\nReactDOM.render(<App />, document.getElementById('root'));\n\n"],"sourceRoot":""}