{"version":3,"sources":["rootCA.crt","imgs/pac-tip.png","configItem.js","App.js","index.js"],"names":["module","exports","confirm","Modal","Meta","Card","itemAction","delete","select","edit","ConfigItem","restartConfirm","title","content","okText","okType","cancelText","onOk","selectConfigConfirm","onCancel","console","log","selectCurItem","props","selectConfig","data","editCurItem","editConfig","doAction","action","turnOffProxyServer","stopCurConfig","this","spinning","runing","tip","onClick","count","itemIndex","style","backgroundColor","fileData","description","actions","className","type","key","fileName","Component","crt","require","Panel","Collapse","App","state","configs","startUpSuc","runningConfigsName","connectError","pacAddress","fetchAllConfigSuc","params","SELECT_CONFIG","payload","ws","send","JSON","stringify","EDIT_CONFIG","showMsg","status","info","message","getPacAddress","GET_PAC_ADDRESS","processStartUp","startSuc","msg","setState","GET_CURRENT_CONFIG","setCurrentConfig","fileNames","map","v","length","setPacAddress","setSelectedItemData","curItemConfig","versionCompare","latestVersion","localVersion","text","showUpdateTip","getCurConfig","fetchAllConfig","FETCH_ALL_CONFIGS","checkUpdate","CHECK_UPDATE","notification","duration","stopConfig","STOP_CONFIG","clearInterval","t","WebSocket","addEventListener","evt","setInterval","result","parse","e","warn","START_CALLBACK","setTimeout","window","location","reload","showIcon","index","proxyIsRunning","includes","href","target","download","src","alt","accordion","header","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.984307b7.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/rootCA.45130045.crt\";","module.exports = __webpack_public_path__ + \"static/media/pac-tip.eea764fb.png\";","import './item.css';\n\nimport React,{Component} from 'react';\nimport {Card, Icon, Avatar, Spin, Modal, Badge} from 'antd';\nconst { confirm } = Modal;\n\nconst { Meta } = Card;\n\nconst itemAction = {\n  delete: 'delete',\n  select: 'select',\n  edit: 'edit'\n}\nexport default  class ConfigItem extends Component{\n  restartConfirm = () => {\n    confirm({\n      title: '切换配置',\n      content: '代理服务器运行中，需要换到当前配置吗？',\n      okText: '好的',\n      okType: 'danger',\n      cancelText: '取消切换',\n      onOk: () => {\n        this.selectConfigConfirm()\n      },\n      onCancel() {\n        console.log('Cancel');\n      },\n    });\n  }\n  \n  selectCurItem = () => {\n    this.selectConfigConfirm();\n  }\n  selectConfigConfirm = () => {\n    this.props.selectConfig(this.props.data)\n  \n  }\n  editCurItem = () => {\n    this.props.editConfig(this.props.data);\n  }\n  doAction = (action) => {\n    switch (action) {\n      case itemAction.select:\n        this.selectCurItem();\n        break;\n      case itemAction.edit:\n        this.editCurItem();\n        break;\n      default:\n        console.log('没有相应的action', action)\n    }\n  }\n  turnOffProxyServer = () => {\n    this.props.stopCurConfig && this.props.stopCurConfig()\n  }\n  render(){\n    const {data} = this.props;\n    return (\n      <Spin spinning={this.props.runing} tip={<div onClick={this.turnOffProxyServer}>代理中,点击可停止... </div>}>\n        <div>\n          <Card\n            title={<div>\n              <Badge count={this.props.itemIndex + 1} style={{ backgroundColor: '#52c41a' }} />\n              {data.fileData.description}</div>}\n            actions={[\n              <div className=\"icon-container\" onClick={() => {this.doAction(itemAction.select)}}>\n                <Icon type=\"heart\" key=\"heart\"/>\n                <span>选择</span>\n              </div>,\n              <div className=\"icon-container\" onClick={() => {this.doAction(itemAction.edit)}}>\n                <Icon type=\"edit\" key=\"edit\"/>\n                <span>修改</span>\n              </div>,\n              <div className=\"icon-container\">\n                <Icon type=\"delete\" key=\"delete\"/>\n                <span>删除</span>\n              </div>,\n            ]}\n          >\n            <Meta\n              description={<div>\n                {data.fileData.description ? data.fileData.description : `${data.fileName}无描述`}</div>}\n            />\n          </Card>\n        </div>\n      </Spin>\n      \n    )\n  }\n}\n","\nimport React, {Component} from 'react';\nimport './App.css';\nimport { message,Alert,notification ,Divider,Collapse,Popover} from 'antd';\nimport ConfigItem from './configItem';\nconst crt = require(\"./rootCA.crt\");\nconst { Panel } = Collapse;\n\n\n\nconst actions = {\n  'FETCH_ALL_CONFIGS': 'getAllConfig',\n  'SELECT_CONFIG': 'select_config',\n  'EDIT_CONFIG': 'edit_config',\n  'START_CALLBACK':'start_callback',\n  'GET_CURRENT_CONFIG': 'get_current_config',\n  'CHECK_UPDATE': 'CHECK_UPDATE',\n  'STOP_CONFIG': 'STOP_CONFIG',\n  'GET_PAC_ADDRESS': 'GET_PAC_ADDRESS'\n}\n\n\nclass App extends Component {\n  state = {\n    configs: [],\n    startUpSuc: false,\n    runningConfigsName: [],\n    connectError: false,\n    pacAddress: '',\n    fetchAllConfigSuc: false\n  }\n  selectConfig = (data) => {\n    const params = {\n      action: actions.SELECT_CONFIG,\n      payload: data\n    }\n    this.ws.send(JSON.stringify(params))\n  }\n  editConfig = (data) => {\n    const params = {\n      action: actions.EDIT_CONFIG,\n      payload: data\n    }\n    this.ws.send(JSON.stringify(params))\n  }\n  showMsg = (status, info) => {\n    message[status](info)\n  }\n  getPacAddress = () => {\n    this.ws.send(JSON.stringify({action: actions.GET_PAC_ADDRESS}));\n  }\n  processStartUp = (payload) => {\n    this.showMsg(payload.startSuc ? 'success' : 'error', payload.msg);\n    this.setState({startUpSuc: payload.startSuc}, () => {\n      // !this.state.startUpSuc && this.restartConfirm()\n      if (this.state.startUpSuc) {\n        this.setState({runningConfigsName: payload.fileName});\n        this.getPacAddress();\n      }\n    });\n    //获取所有启动项目\n    this.ws.send(JSON.stringify({action: actions.GET_CURRENT_CONFIG}));\n  }\n  setCurrentConfig = (payload) => {\n    // debugger\n    const fileNames = payload.map(v => v.fileName);\n    this.setState({runningConfigsName: fileNames});\n    if (fileNames.length === 0) {\n      this.ws.send(JSON.stringify({action: actions.GET_PAC_ADDRESS}));\n    }\n  }\n  setPacAddress = (pacAddress) => {\n    this.setState({pacAddress})\n  }\n  setSelectedItemData = (data) => {\n    this.setState({curItemConfig: data})\n  }\n  versionCompare = ({latestVersion,localVersion}) => {\n    if (latestVersion !== localVersion) {\n      const text = `检测到新版本${latestVersion},当前版本为${localVersion},请升级获得更多代理规则支持 + 错误修复`\n      this.showUpdateTip(text)\n    }\n  }\n  getCurConfig = () => {\n    this.fetchAllConfig();\n    this.ws.send(JSON.stringify({action: actions.GET_CURRENT_CONFIG}));\n  }\n  fetchAllConfig = () => {\n    this.ws.send(JSON.stringify({action: actions.FETCH_ALL_CONFIGS}));\n  }\n  componentWillUnmount() {\n    clearInterval(this.t)\n  }\n  \n  componentDidMount() {\n    //发送请求获取配置信息\n    let ws = new WebSocket(\"ws://localhost:9876\");\n    this.ws = ws;\n    \n    ws.addEventListener(\"open\",(evt) => {\n      console.log(\"Connection open ...\");\n      // ws.send(\"Hello WebSockets!\");\n      this.setState({connectError: false});\n      this.getCurConfig();\n      this.checkUpdate();\n      this.t = setInterval(this.fetchAllConfig, 3000)\n    })\n  \n  \n    ws.addEventListener(\"message\",(evt) => {\n      console.log( \"Received Message: \" , evt.data);\n      // ws.close();\n      let result ;\n      try {\n        result = JSON.parse(evt.data);\n      } catch (e) {\n        console.warn('传递数据无法json化，格式错误');\n        return\n      }\n      if (result.action === actions.FETCH_ALL_CONFIGS) {\n        if ((this.state.configs.length !== result.payload.length) && (this.state.fetchAllConfigSuc === true)) {\n          this.showUpdateTip('检测到配置文件数量变化，已经更新最新配置', \"配置文件已更新\");\n        }\n        this.setState({configs: result.payload, fetchAllConfigSuc: true});\n      }\n      if (result.action === actions.START_CALLBACK) {\n        const {payload} = result;\n        this.processStartUp(payload)\n      }\n      if (result.action === actions.GET_CURRENT_CONFIG) {\n        const {payload} = result;\n        payload && this.setCurrentConfig(payload);\n        this.getPacAddress();\n      }\n      if (result.action === actions.GET_PAC_ADDRESS) {\n        const {payload} = result;\n        payload && this.setPacAddress(payload)\n      }\n      if (result.action === actions.EDIT_CONFIG) {\n        const {payload} = result;\n        payload && this.setSelectedItemData(payload)\n      }\n      if (result.action === actions.CHECK_UPDATE) {\n        const {payload} = result;\n        payload && this.versionCompare(payload)\n      }\n      \n    })\n  \n    ws.addEventListener('close', (evt) => {\n      console.log(\"Connection closed.\");\n      this.setState({connectError: true});\n      setTimeout(() => {\n        window.location.reload()\n      }, 10000)\n    });\n  }\n  checkUpdate = (data) => {\n    const params = {\n      action: actions.CHECK_UPDATE,\n      payload: data\n    }\n    this.ws.send(JSON.stringify(params))\n  }\n  showUpdateTip = (text, message) => {\n    notification['info']({\n      message: message || 'b-proxy-cli 检测到新版本',\n      duration:null,\n      description:text\n    });\n  \n  }\n  stopConfig = (fileName) => {\n    const params = {\n      action: actions.STOP_CONFIG,\n      payload: fileName\n    }\n    this.ws.send(JSON.stringify(params));\n    // setTimeout(this.getCurConfig,1000)\n  }\n  \n  render(){\n  \n    return (\n      <div className=\"App\">\n        \n        {this.state.connectError && (\n          <Alert\n            message=\"与代理服务器的通信失败\"\n            description=\"代理服务器可能没有启动,10s后网页会刷新重试...\"\n            type=\"error\"\n            showIcon\n          />\n        )}\n          <div className={'config-container'}>\n            {this.state.configs.map((v,index) => {\n              return (\n                <ConfigItem\n                  selectConfig={this.selectConfig}\n                  editConfig={this.editConfig}\n                  stopCurConfig={()=>{this.stopConfig(v.fileName)}}\n                  data = {v}\n                  proxyIsRunning={this.state.runningConfigsName.length !== 0}\n                  runing={this.state.runningConfigsName.includes(v.fileName)}\n                  key={index}\n                  itemIndex={index}\n                />\n              )\n            })}\n          </div>\n        <Divider/>\n        \n        <div className={'footer'}>\n          <a href={crt} target={\"_blank\"} download>点击下载根证书</a>\n          <div>\n            <p>            windows下配置信任根证书：<a target={\"_blank\"} href=\"https://jingyan.baidu.com/article/9f7e7ec0c1107c6f29155461.html\">点击查看</a></p>\n            <p>\n              mac下配置信任根证书：<a target={\"_blank\"} href=\"https://blog.51cto.com/viming/2161919\">点击查看</a>\n\n            </p>\n          </div>\n          {!this.state.connectError && (\n            <div>\n              <Popover content={<div><img src={require(\"./imgs/pac-tip.png\")} alt=\"\"/></div>} title=\"在mac中配置自动代理链接\">\n                  <span>\n                    自动代理配置url：{this.state.pacAddress}\n                  </span>\n              </Popover>\n\n            </div>\n          )}\n          <Divider/>\n          <Collapse accordion>\n            <Panel header=\"如何备份我的配置\" key=\"1\">\n              <p>组件升级的时候，会覆盖安装组件，覆盖配置文件，为了保存你的配置文件，请拷贝配置文件到其他地方，当更新后，拷贝回来即可</p>\n            </Panel>\n          </Collapse>\n        </div>\n      </div>\n    );\n  }\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport 'antd/dist/antd.css'\nReactDOM.render(<App />, document.getElementById('root'));\n\n"],"sourceRoot":""}